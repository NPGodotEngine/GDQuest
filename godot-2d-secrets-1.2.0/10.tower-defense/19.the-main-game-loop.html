<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>&#39;the main game loop&#39;</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="data:text/css,%3Aroot%20%7B%2D%2Dcolor%2Dcaption%3A%20grey%3B%2D%2Dcolor%2Dblue%3A%20%2326bfe3%3B%2D%2Dcolor%2Dgreen%3A%20%2302e180%3B%2D%2Dcolor%2Dorange%3A%20%23f2971a%3B%2D%2Dcolor%2Dpink%3A%20%23e3266f%3B%2D%2Dcolor%2Dbg%3A%20%23fff%3B%2D%2Dcolor%2Dbg%2Dalt%3A%20%23f5f5f5%3B%2D%2Dcolor%2Dtext%2Dheader%3A%20%23fff%3B%2D%2Dcolor%2Dtext%2Dbody%3A%20%2395989a%3B%2D%2Dpadding%3A%2020px%3B%2D%2Dpadding%2Dinv%3A%20calc%28%2D1%20%2A%20var%28%2D%2Dpadding%29%29%3B%2D%2Dfonts%3A%20%27Open%20Sans%27%2C%20%2Dapple%2Dsystem%2C%20system%2Dui%2C%20%27Segoe%20UI%27%2C%20%27Roboto%27%2C%27Helvetica%20Neue%27%2C%20Arial%2C%20sans%2Dserif%3B%2D%2Dfont%2Dsize%3A%201%2E1rem%3B%7Dhtml%20%7Bfont%2Dsize%3A%20100%25%3B%7Dbody%20%7Bcolor%3A%20%23444%3Bfont%2Dfamily%3A%20var%28%2D%2Dfonts%29%3Bfont%2Dsize%3A%20var%28%2D%2Dfont%2Dsize%29%3Bline%2Dheight%3A%201%2E7%3Bpadding%3A%201em%3Bmargin%3A%20auto%3Bmax%2Dwidth%3A%20800px%3Bbackground%3A%20%23fefefe%3B%7Da%20%7Bcolor%3A%20%230645ad%3Btext%2Ddecoration%3A%20none%3B%7Da%3Avisited%20%7Bcolor%3A%20%230b0080%3B%7Da%3Ahover%20%7Bcolor%3A%20%2306e%3B%7Da%3Aactive%20%7Bcolor%3A%20%23faa700%3B%7Da%3Afocus%20%7Boutline%3A%20thin%20dotted%3B%7Da%3A%3Aselection%20%7Bbackground%3A%20rgba%28255%2C%20255%2C%200%2C%200%2E3%29%3Bcolor%3A%20%230645ad%3B%7D%2A%3A%3Aselection%20%7Bbackground%3A%20rgba%28255%2C%20255%2C%200%2C%200%2E3%29%3Bcolor%3A%20%23000%3B%7Dp%20%7Bmargin%3A%201em%200%3B%7D%2Ecaption%20%7Btext%2Dalign%3A%20center%3Bcolor%3A%20var%28%2D%2Dcolor%2Dcaption%29%3Bfont%2Dstyle%3A%20italic%3B%7D%2Enote%2C%2Etips%2C%2Ewarning%20%7Bdisplay%3A%20block%3Bwidth%3A%20calc%28100%25%20%2D%20var%28%2D%2Dpadding%29%20%2A%202%29%3Bpadding%3A%200%20var%28%2D%2Dpadding%29%3Bpadding%2Dbottom%3A%20var%28%2D%2Dpadding%29%3Bbackground%2Dcolor%3A%20var%28%2D%2Dcolor%2Dbg%2Dalt%29%3B%7D%2Enote%3Abefore%2C%2Etips%3Abefore%2C%2Ewarning%3Abefore%20%7Bdisplay%3A%20block%3Bmargin%3A%200%20var%28%2D%2Dpadding%2Dinv%29%2010px%20var%28%2D%2Dpadding%2Dinv%29%3Bpadding%2Dleft%3A%20var%28%2D%2Dpadding%29%3Bfont%2Dstyle%3A%20bold%3Bcolor%3A%20white%3B%7D%2Enote%3Abefore%20%7Bcontent%3A%20%27Note%27%3Bbackground%2Dcolor%3A%20var%28%2D%2Dcolor%2Dblue%29%3B%7D%2Etips%3Abefore%20%7Bcontent%3A%20%27Tips%27%3Bbackground%2Dcolor%3A%20var%28%2D%2Dcolor%2Dpink%29%3B%7D%2Ewarning%3Abefore%20%7Bcontent%3A%20%27Warning%27%3Bbackground%2Dcolor%3A%20var%28%2D%2Dcolor%2Dorange%29%3B%7Dimg%20%7Bmax%2Dwidth%3A%20100%25%3B%7Dh1%2Ch2%2Ch3%2Ch4%2Ch5%2Ch6%20%7Bcolor%3A%20%23111%3Bline%2Dheight%3A%20125%25%3Bmargin%2Dtop%3A%202em%3Bfont%2Dweight%3A%20normal%3B%7Dh4%2Ch5%2Ch6%20%7Bfont%2Dweight%3A%20bold%3B%7Dh1%20%7Bfont%2Dsize%3A%202%2E5em%3B%7Dh2%20%7Bfont%2Dsize%3A%202em%3B%7Dh3%20%7Bfont%2Dsize%3A%201%2E5em%3B%7Dh4%20%7Bfont%2Dsize%3A%201%2E2em%3B%7Dblockquote%20%7Bcolor%3A%20%23666666%3Bmargin%3A%200%3Bpadding%2Dleft%3A%203em%3Bborder%2Dleft%3A%200%2E5em%20%23eee%20solid%3B%7Dhr%20%7Bdisplay%3A%20block%3Bheight%3A%202px%3Bborder%3A%200%3Bborder%2Dtop%3A%201px%20solid%20%23aaa%3Bborder%2Dbottom%3A%201px%20solid%20%23eee%3Bmargin%3A%201em%200%3Bpadding%3A%200%3B%7Dpre%2Ccode%2Ckbd%2Csamp%20%7Bcolor%3A%20%230084b8%3Bfont%2Dfamily%3A%20monospace%2C%20monospace%3B%7Dpre%20%7Bpadding%3A%201em%3Bfont%2Dsize%3A%2014px%3Bwhite%2Dspace%3A%20pre%2Dwrap%3Bword%2Dwrap%3A%20break%2Dword%3B%7Dcode%20%7Bwhite%2Dspace%3A%20pre%2Dwrap%3B%7Db%2Cstrong%20%7Bfont%2Dweight%3A%20bold%3B%7Ddfn%20%7Bfont%2Dstyle%3A%20italic%3Bcolor%3A%20var%28%2D%2Dcolor%2Dblue%29%3B%7Dins%20%7Bbackground%3A%20%23ff9%3Bcolor%3A%20%23000%3Btext%2Ddecoration%3A%20none%3B%7Dul%2Col%20%7Bmargin%3A%201em%200%3Bpadding%3A%200%200%200%202em%3B%7Dli%20p%3Alast%2Dchild%20%7Bmargin%2Dbottom%3A%200%3B%7Dul%20ul%2Col%20ol%20%7Bmargin%3A%200%2E3em%200%3B%7Ddl%20%7Bmargin%2Dbottom%3A%201em%3B%7Ddt%20%7Bfont%2Dweight%3A%20bold%3Bmargin%2Dbottom%3A%200%2E8em%3B%7Ddd%20%7Bmargin%3A%200%200%200%2E8em%202em%3B%7Ddd%3Alast%2Dchild%20%7Bmargin%2Dbottom%3A%200%3B%7Dimg%20%7Bborder%3A%200%3B%2Dms%2Dinterpolation%2Dmode%3A%20bicubic%3Bvertical%2Dalign%3A%20middle%3B%7Dfigure%20%7Bdisplay%3A%20block%3Btext%2Dalign%3A%20center%3Bmargin%3A%201em%200%3B%7Dfigure%20img%20%7Bborder%3A%20none%3Bmargin%3A%200%20auto%3B%7Dfigcaption%20%7Bfont%2Dsize%3A%200%2E8em%3Bfont%2Dstyle%3A%20italic%3Bmargin%3A%200%200%200%2E8em%3B%7D%2Eauthor%20%7Bfont%2Dsize%3A%201%2E2em%3Btext%2Dalign%3A%20center%3B%7Dtag%20%7Bmin%2Dwidth%3A%203%2E2em%3Btext%2Dalign%3A%20center%3Bborder%2Dradius%3A%208px%3Bpadding%3A%200%204px%3Bmargin%2Dbottom%3A%200%3Bmargin%2Dtop%3A%204px%3Bmargin%2Dright%3A%200%2E2em%3Bdisplay%3A%20inline%2Dblock%3Bcolor%3A%20white%3B%7Dtag%2Eupdate%20%7Bbackground%3A%20var%28%2D%2Dcolor%2Dblue%29%3B%7Dtag%2Enew%20%7Bbackground%3A%20var%28%2D%2Dcolor%2Dgreen%29%3B%7Dtag%2Eupdate%3Aafter%20%7Bcontent%3A%20%27update%27%3B%7Dtag%2Enew%3Aafter%20%7Bcontent%3A%20%27new%27%3B%7Dbutton%20%7Bbackground%2Dcolor%3A%20var%28%2D%2Dcolor%2Dblue%29%3Bcolor%3A%20white%3Bborder%3A%20none%3Bcursor%3A%20pointer%3Bline%2Dheight%3A%202rem%3Bfont%2Dsize%3A%201%2E2rem%3Bmargin%3A%200%2E75rem%200%3Boverflow%3A%20visible%3Bpadding%3A%200%2E75rem%201%2E5rem%3Bborder%2Dradius%3A%201rem%3Btransition%3A%20background%2Dcolor%200%2E5%3Bwhite%2Dspace%3A%20nowrap%3B%7D%2Enode%2Dicon%20%7Bposition%3A%20relative%3Bbottom%3A%201%2E3px%3Bpadding%2Dright%3A%203px%3Bheight%3A%2018px%3B%7D%2Evideo%2Dyoutube%20%7Bbackground%2Dcolor%3A%20%23000%3Bposition%3A%20relative%3Bcursor%3A%20pointer%3B%7D%2Evideo%2Dyoutube%20%3E%20%2Eplaybutton%20%7Bpointer%2Devents%3A%20none%3Bwidth%3A%2090px%3Bheight%3A%2060px%3Bbackground%2Dcolor%3A%20%23333%3Bbox%2Dshadow%3A%200%200%2018px%20rgba%280%2C%200%2C%200%2C%200%2E6%29%3Bz%2Dindex%3A%201%3Bopacity%3A%200%2E8%3Bborder%2Dradius%3A%206px%3B%7D%2Eplaybutton%3Abefore%20%7Bcontent%3A%20%27%27%3Bborder%2Dstyle%3A%20solid%3Bborder%2Dwidth%3A%2015px%200%2015px%2026px%3Bborder%2Dcolor%3A%20transparent%20transparent%20transparent%20%23fff%3B%7D%2Evideo%2Dyoutube%20%3E%20img%2C%2Evideo%2Dyoutube%20%3E%20%2Eplaybutton%20%7Bcursor%3A%20pointer%3B%7D%2Evideo%2Dyoutube%20%3E%20img%2C%2Evideo%2Dyoutube%20%3E%20%2Eplaybutton%2C%2Evideo%2Dyoutube%20%3E%20%2Eplaybutton%3Abefore%20%7Bposition%3A%20absolute%3B%7D%2Eplaybutton%2C%2Eplaybutton%3Abefore%20%7Btop%3A%2050%25%3Bleft%3A%2050%25%3Btransform%3A%20translate3d%28%2D50%25%2C%20%2D50%25%2C%200%29%3B%7D" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="creating-the-games-main-loop">Creating the Game’s Main Loop</h1>
<p>We now have all the elements we need to create our game: a game world, the level, a way to interact with this world, and the UI. We also have the most important element: an abstraction of the player. Let’s add this last piece as a child of the <em>Game</em> node. This is how the <em>Game</em> <code>SceneTree</code> should look like:</p>
<p><img src="data:image/png;base64,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" /></p>
<p>Attach a script to the root and save as <code>res://Game.gd</code>. Let’s open the script and start the implementation of our game’s flow and the main loop.</p>
<p>We wire everything together and provide all the dependencies we need for the game to start. We link the interface elements to their game elements and set them up.</p>
<pre style="color:#f8f8f2;background-color:#272822"><span style="color:#75715e"># Initializes the user interface, forwarding it the data it needs from the game</span>
<span style="color:#75715e"># world.</span>
<span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Node</span>

<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> _player :<span style="color:#f92672">=</span> <span style="color:#f92672">$</span>Player
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> _level :<span style="color:#f92672">=</span> <span style="color:#f92672">$</span>Level
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> _hud :<span style="color:#f92672">=</span> <span style="color:#f92672">$</span>UILayer<span style="color:#f92672">/</span>UI<span style="color:#f92672">/</span>HUD
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> _tower_shop :<span style="color:#f92672">=</span> <span style="color:#f92672">$</span>UILayer<span style="color:#f92672">/</span>UI<span style="color:#f92672">/</span>HUD<span style="color:#f92672">/</span>UITowerShop
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> _screen_overlay :<span style="color:#f92672">=</span> <span style="color:#f92672">$</span>UILayer<span style="color:#f92672">/</span>UI<span style="color:#f92672">/</span>UIScreenOverlay
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> _mouse_barrier :<span style="color:#f92672">=</span> <span style="color:#f92672">$</span>UILayer<span style="color:#f92672">/</span>UI<span style="color:#f92672">/</span>MouseBarrier
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> _retry_button :<span style="color:#f92672">=</span> <span style="color:#f92672">$</span>UILayer<span style="color:#f92672">/</span>UI<span style="color:#f92672">/</span>HUD<span style="color:#f92672">/</span>RetryButton
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> _start_button :<span style="color:#f92672">=</span> <span style="color:#f92672">$</span>UILayer<span style="color:#f92672">/</span>UI<span style="color:#f92672">/</span>HUD<span style="color:#f92672">/</span>StartButton
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> _gold_panel :<span style="color:#f92672">=</span> <span style="color:#f92672">$</span>UILayer<span style="color:#f92672">/</span>UI<span style="color:#f92672">/</span>HUD<span style="color:#f92672">/</span>UIGoldPanel
</pre>
<p>Remember in our <em>UITowerShop</em> test that we connected some signals and fed it with a player? We do the same here, but using code.</p>
<p>Back in our shop test, we had the <em>TowerPlacer</em> available at the <code>SceneTree</code>, but now it’s part of the <em>Level</em>. We can access it through the <code>_level.tower_placer</code> variable. We connect its <code>tower_placed</code> signal to the <code>_tower_shop</code>’s <code>_on_TowerPlacer_tower_placed()</code> callback.</p>
<p>The shop feeds the <em>TowerPlacer</em> with towers, so let’s connect the <code>_tower_shop</code> <code>tower_purchased</code> signal to the <code>_level.tower_placer</code> <code>add_new_tower()</code> method.</p>
<p>We pass the player to the shop and to the <code>_gold_panel</code>. The gold panel needs a player to sync the gold it displays with the player’s current gold amount.</p>
<pre style="color:#f8f8f2;background-color:#272822"><span style="color:#66d9ef">func</span> _ready() <span style="color:#f92672">-&gt;</span> void:
    _level<span style="color:#f92672">.</span>tower_placer<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&quot;tower_placed&quot;</span>, _tower_shop, <span style="color:#e6db74">&quot;_on_TowerPlacer_tower_placed&quot;</span>)
    _tower_shop<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&quot;tower_purchased&quot;</span>, _level<span style="color:#f92672">.</span>tower_placer, <span style="color:#e6db74">&quot;add_new_tower&quot;</span>)
    _tower_shop<span style="color:#f92672">.</span>player <span style="color:#f92672">=</span> _player
    _gold_panel<span style="color:#f92672">.</span>player <span style="color:#f92672">=</span> _player
</pre>
<p>If we test our <em>Game</em> scene, we should be able to purchase and place towers as long as we have enough gold. This is the planning mode. Now we need to make the transition to the play mode where the action begins.</p>
<p>In the play mode, we must prevent players from interacting with the game. We create two methods to toggle our interface elements and the mouse barrier.</p>
<pre style="color:#f8f8f2;background-color:#272822"><span style="color:#66d9ef">func</span> _toggle_interface() <span style="color:#f92672">-&gt;</span> void:
    _hud<span style="color:#f92672">.</span>visible <span style="color:#f92672">=</span> <span style="color:#f92672">not</span> _hud<span style="color:#f92672">.</span>visible
    _toggle_mouse_barrier()


<span style="color:#75715e"># Prevents mouse interactions in play mode</span>
<span style="color:#66d9ef">func</span> _toggle_mouse_barrier() <span style="color:#f92672">-&gt;</span> void:
    _mouse_barrier<span style="color:#f92672">.</span>visible <span style="color:#f92672">=</span> <span style="color:#f92672">not</span> _mouse_barrier<span style="color:#f92672">.</span>visible
</pre>
<p>We have a way to prevent players from interacting with the game during the play mode.</p>
<p>To enter the play mode, we need to start the level. Connect the <em>StartButton</em>’s <code>pressed</code> signal to the <em>Game</em> to create the <code>_on_StartButton_pressed()</code> callback.</p>
<p>In this callback, we toggle the interface and deselect all towers to hide their interfaces as well. We make a group call to the <code>&quot;selected&quot;</code> group to set the selection to false.</p>
<p>To provide a bit of anticipation to players, we play the wave start animation on the <code>_UIScreenOverlay_</code>. We use the <code>yield</code> keyword to delay the start until the animation completes.</p>
<pre style="color:#f8f8f2;background-color:#272822"><span style="color:#66d9ef">func</span> _on_StartButton_pressed() <span style="color:#f92672">-&gt;</span> void:
    <span style="color:#75715e"># Enters in the &quot;play mode&quot;. In play mode, players become passive to the</span>
    <span style="color:#75715e"># game&#39;s event. Interface becomes invisible and the Level starts.</span>
    _toggle_interface()
    get_tree()<span style="color:#f92672">.</span>call_group(<span style="color:#e6db74">&quot;selected&quot;</span>, <span style="color:#e6db74">&quot;set_selected&quot;</span>, false)
    yield(_screen_overlay<span style="color:#f92672">.</span>play_wave_start_async(), <span style="color:#e6db74">&quot;completed&quot;</span>)
    _level<span style="color:#f92672">.</span>start()
</pre>
<p>Let’s give the game another test to see if everything is working. At this point, we should be able to put towers and start the game by pressing the <em>StartButton</em>.</p>
<p>To complete the main game loop, we need to go back to the <em>Plan Mode</em>. The <em>Level</em> has a signal to notify when the round finishes. Connect it to the <em>Game</em>’s <code>_on_Level_round_finished()</code> callback.</p>
<p>When the round finishes, we need to toggle the interface and redraw the <em>Enemies</em> walking path. Remember, the <code>_level.show_walkable_path()</code> is public, so let’s use it!</p>
<pre style="color:#f8f8f2;background-color:#272822"><span style="color:#66d9ef">func</span> _on_Level_round_finished() <span style="color:#f92672">-&gt;</span> void:
    <span style="color:#75715e"># Enters in the &quot;plan mode&quot;. In plan mode, players can take actions and plan</span>
    <span style="color:#75715e"># their Tower Layout for the next wave. Interface becomes visible again.</span>
    _toggle_interface()
    _level<span style="color:#f92672">.</span>show_walkable_path()
</pre>
<p>There we have it! A full round of towers shooting evil goo enemies. Now players can add new towers and face the next waves of enemies until there are no waves to defeat. At this point, this happens after the second wave if the enemies don’t defeat the player first.</p>
</body>
</html>
