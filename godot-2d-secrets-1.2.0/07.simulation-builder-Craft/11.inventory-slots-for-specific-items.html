<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>&#39;inventory slots for specific items&#39;</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="data:text/css,%3Aroot%20%7B%2D%2Dcolor%2Dcaption%3A%20grey%3B%2D%2Dcolor%2Dblue%3A%20%2326bfe3%3B%2D%2Dcolor%2Dgreen%3A%20%2302e180%3B%2D%2Dcolor%2Dorange%3A%20%23f2971a%3B%2D%2Dcolor%2Dpink%3A%20%23e3266f%3B%2D%2Dcolor%2Dbg%3A%20%23fff%3B%2D%2Dcolor%2Dbg%2Dalt%3A%20%23f5f5f5%3B%2D%2Dcolor%2Dtext%2Dheader%3A%20%23fff%3B%2D%2Dcolor%2Dtext%2Dbody%3A%20%2395989a%3B%2D%2Dpadding%3A%2020px%3B%2D%2Dpadding%2Dinv%3A%20calc%28%2D1%20%2A%20var%28%2D%2Dpadding%29%29%3B%2D%2Dfonts%3A%20%27Open%20Sans%27%2C%20%2Dapple%2Dsystem%2C%20system%2Dui%2C%20%27Segoe%20UI%27%2C%20%27Roboto%27%2C%27Helvetica%20Neue%27%2C%20Arial%2C%20sans%2Dserif%3B%2D%2Dfont%2Dsize%3A%201%2E1rem%3B%7Dhtml%20%7Bfont%2Dsize%3A%20100%25%3B%7Dbody%20%7Bcolor%3A%20%23444%3Bfont%2Dfamily%3A%20var%28%2D%2Dfonts%29%3Bfont%2Dsize%3A%20var%28%2D%2Dfont%2Dsize%29%3Bline%2Dheight%3A%201%2E7%3Bpadding%3A%201em%3Bmargin%3A%20auto%3Bmax%2Dwidth%3A%20800px%3Bbackground%3A%20%23fefefe%3B%7Da%20%7Bcolor%3A%20%230645ad%3Btext%2Ddecoration%3A%20none%3B%7Da%3Avisited%20%7Bcolor%3A%20%230b0080%3B%7Da%3Ahover%20%7Bcolor%3A%20%2306e%3B%7Da%3Aactive%20%7Bcolor%3A%20%23faa700%3B%7Da%3Afocus%20%7Boutline%3A%20thin%20dotted%3B%7Da%3A%3Aselection%20%7Bbackground%3A%20rgba%28255%2C%20255%2C%200%2C%200%2E3%29%3Bcolor%3A%20%230645ad%3B%7D%2A%3A%3Aselection%20%7Bbackground%3A%20rgba%28255%2C%20255%2C%200%2C%200%2E3%29%3Bcolor%3A%20%23000%3B%7Dp%20%7Bmargin%3A%201em%200%3B%7D%2Ecaption%20%7Btext%2Dalign%3A%20center%3Bcolor%3A%20var%28%2D%2Dcolor%2Dcaption%29%3Bfont%2Dstyle%3A%20italic%3B%7D%2Enote%2C%2Etips%2C%2Ewarning%20%7Bdisplay%3A%20block%3Bwidth%3A%20calc%28100%25%20%2D%20var%28%2D%2Dpadding%29%20%2A%202%29%3Bpadding%3A%200%20var%28%2D%2Dpadding%29%3Bpadding%2Dbottom%3A%20var%28%2D%2Dpadding%29%3Bbackground%2Dcolor%3A%20var%28%2D%2Dcolor%2Dbg%2Dalt%29%3B%7D%2Enote%3Abefore%2C%2Etips%3Abefore%2C%2Ewarning%3Abefore%20%7Bdisplay%3A%20block%3Bmargin%3A%200%20var%28%2D%2Dpadding%2Dinv%29%2010px%20var%28%2D%2Dpadding%2Dinv%29%3Bpadding%2Dleft%3A%20var%28%2D%2Dpadding%29%3Bfont%2Dstyle%3A%20bold%3Bcolor%3A%20white%3B%7D%2Enote%3Abefore%20%7Bcontent%3A%20%27Note%27%3Bbackground%2Dcolor%3A%20var%28%2D%2Dcolor%2Dblue%29%3B%7D%2Etips%3Abefore%20%7Bcontent%3A%20%27Tips%27%3Bbackground%2Dcolor%3A%20var%28%2D%2Dcolor%2Dpink%29%3B%7D%2Ewarning%3Abefore%20%7Bcontent%3A%20%27Warning%27%3Bbackground%2Dcolor%3A%20var%28%2D%2Dcolor%2Dorange%29%3B%7Dimg%20%7Bmax%2Dwidth%3A%20100%25%3B%7Dh1%2Ch2%2Ch3%2Ch4%2Ch5%2Ch6%20%7Bcolor%3A%20%23111%3Bline%2Dheight%3A%20125%25%3Bmargin%2Dtop%3A%202em%3Bfont%2Dweight%3A%20normal%3B%7Dh4%2Ch5%2Ch6%20%7Bfont%2Dweight%3A%20bold%3B%7Dh1%20%7Bfont%2Dsize%3A%202%2E5em%3B%7Dh2%20%7Bfont%2Dsize%3A%202em%3B%7Dh3%20%7Bfont%2Dsize%3A%201%2E5em%3B%7Dh4%20%7Bfont%2Dsize%3A%201%2E2em%3B%7Dblockquote%20%7Bcolor%3A%20%23666666%3Bmargin%3A%200%3Bpadding%2Dleft%3A%203em%3Bborder%2Dleft%3A%200%2E5em%20%23eee%20solid%3B%7Dhr%20%7Bdisplay%3A%20block%3Bheight%3A%202px%3Bborder%3A%200%3Bborder%2Dtop%3A%201px%20solid%20%23aaa%3Bborder%2Dbottom%3A%201px%20solid%20%23eee%3Bmargin%3A%201em%200%3Bpadding%3A%200%3B%7Dpre%2Ccode%2Ckbd%2Csamp%20%7Bcolor%3A%20%230084b8%3Bfont%2Dfamily%3A%20monospace%2C%20monospace%3B%7Dpre%20%7Bpadding%3A%201em%3Bfont%2Dsize%3A%2014px%3Bwhite%2Dspace%3A%20pre%2Dwrap%3Bword%2Dwrap%3A%20break%2Dword%3B%7Dcode%20%7Bwhite%2Dspace%3A%20pre%2Dwrap%3B%7Db%2Cstrong%20%7Bfont%2Dweight%3A%20bold%3B%7Ddfn%20%7Bfont%2Dstyle%3A%20italic%3Bcolor%3A%20var%28%2D%2Dcolor%2Dblue%29%3B%7Dins%20%7Bbackground%3A%20%23ff9%3Bcolor%3A%20%23000%3Btext%2Ddecoration%3A%20none%3B%7Dul%2Col%20%7Bmargin%3A%201em%200%3Bpadding%3A%200%200%200%202em%3B%7Dli%20p%3Alast%2Dchild%20%7Bmargin%2Dbottom%3A%200%3B%7Dul%20ul%2Col%20ol%20%7Bmargin%3A%200%2E3em%200%3B%7Ddl%20%7Bmargin%2Dbottom%3A%201em%3B%7Ddt%20%7Bfont%2Dweight%3A%20bold%3Bmargin%2Dbottom%3A%200%2E8em%3B%7Ddd%20%7Bmargin%3A%200%200%200%2E8em%202em%3B%7Ddd%3Alast%2Dchild%20%7Bmargin%2Dbottom%3A%200%3B%7Dimg%20%7Bborder%3A%200%3B%2Dms%2Dinterpolation%2Dmode%3A%20bicubic%3Bvertical%2Dalign%3A%20middle%3B%7Dfigure%20%7Bdisplay%3A%20block%3Btext%2Dalign%3A%20center%3Bmargin%3A%201em%200%3B%7Dfigure%20img%20%7Bborder%3A%20none%3Bmargin%3A%200%20auto%3B%7Dfigcaption%20%7Bfont%2Dsize%3A%200%2E8em%3Bfont%2Dstyle%3A%20italic%3Bmargin%3A%200%200%200%2E8em%3B%7D%2Eauthor%20%7Bfont%2Dsize%3A%201%2E2em%3Btext%2Dalign%3A%20center%3B%7Dtag%20%7Bmin%2Dwidth%3A%203%2E2em%3Btext%2Dalign%3A%20center%3Bborder%2Dradius%3A%208px%3Bpadding%3A%200%204px%3Bmargin%2Dbottom%3A%200%3Bmargin%2Dtop%3A%204px%3Bmargin%2Dright%3A%200%2E2em%3Bdisplay%3A%20inline%2Dblock%3Bcolor%3A%20white%3B%7Dtag%2Eupdate%20%7Bbackground%3A%20var%28%2D%2Dcolor%2Dblue%29%3B%7Dtag%2Enew%20%7Bbackground%3A%20var%28%2D%2Dcolor%2Dgreen%29%3B%7Dtag%2Eupdate%3Aafter%20%7Bcontent%3A%20%27update%27%3B%7Dtag%2Enew%3Aafter%20%7Bcontent%3A%20%27new%27%3B%7Dbutton%20%7Bbackground%2Dcolor%3A%20var%28%2D%2Dcolor%2Dblue%29%3Bcolor%3A%20white%3Bborder%3A%20none%3Bcursor%3A%20pointer%3Bline%2Dheight%3A%202rem%3Bfont%2Dsize%3A%201%2E2rem%3Bmargin%3A%200%2E75rem%200%3Boverflow%3A%20visible%3Bpadding%3A%200%2E75rem%201%2E5rem%3Bborder%2Dradius%3A%201rem%3Btransition%3A%20background%2Dcolor%200%2E5%3Bwhite%2Dspace%3A%20nowrap%3B%7D%2Enode%2Dicon%20%7Bposition%3A%20relative%3Bbottom%3A%201%2E3px%3Bpadding%2Dright%3A%203px%3Bheight%3A%2018px%3B%7D%2Evideo%2Dyoutube%20%7Bbackground%2Dcolor%3A%20%23000%3Bposition%3A%20relative%3Bcursor%3A%20pointer%3B%7D%2Evideo%2Dyoutube%20%3E%20%2Eplaybutton%20%7Bpointer%2Devents%3A%20none%3Bwidth%3A%2090px%3Bheight%3A%2060px%3Bbackground%2Dcolor%3A%20%23333%3Bbox%2Dshadow%3A%200%200%2018px%20rgba%280%2C%200%2C%200%2C%200%2E6%29%3Bz%2Dindex%3A%201%3Bopacity%3A%200%2E8%3Bborder%2Dradius%3A%206px%3B%7D%2Eplaybutton%3Abefore%20%7Bcontent%3A%20%27%27%3Bborder%2Dstyle%3A%20solid%3Bborder%2Dwidth%3A%2015px%200%2015px%2026px%3Bborder%2Dcolor%3A%20transparent%20transparent%20transparent%20%23fff%3B%7D%2Evideo%2Dyoutube%20%3E%20img%2C%2Evideo%2Dyoutube%20%3E%20%2Eplaybutton%20%7Bcursor%3A%20pointer%3B%7D%2Evideo%2Dyoutube%20%3E%20img%2C%2Evideo%2Dyoutube%20%3E%20%2Eplaybutton%2C%2Evideo%2Dyoutube%20%3E%20%2Eplaybutton%3Abefore%20%7Bposition%3A%20absolute%3B%7D%2Eplaybutton%2C%2Eplaybutton%3Abefore%20%7Btop%3A%2050%25%3Bleft%3A%2050%25%3Btransform%3A%20translate3d%28%2D50%25%2C%20%2D50%25%2C%200%29%3B%7D" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="inventory-slots-for-specific-items">Inventory slots for specific items</h1>
<p>The Stirling engine has been this source of unending cosmic power this entire time, providing flat <code>25</code> units of power forever.</p>
<p>That’s useful, but not precisely balanced.</p>
<p>A Stirling engine has gas in its chamber, and applying heat causes it to expand and push the piston.</p>
<p>We should provide a slot that can accept nothing but fuel, like charcoal. The engine burns one piece of it at a time to produce power for a limited duration.</p>
<p>To do so, we need to add the ability only to accept some items.</p>
<p>Right now, we can put any item in any inventory slot. But we want the engine only to accept fuel sources. To do so, we’ll implement item filters.</p>
<h2 id="item-filters">Item filters</h2>
<p>Filters are a set of keywords that refer either to a category of objects, like “Fuels”, or to a specific item, like “Ore”.</p>
<p>When the user clicks on a panel with an item, we check that the selected item matches the defined filter, if applicable.</p>
<p>We’ll create the filter list as a space-delineated string on the <code>InventoryBar</code> and split it into an array. We’ll then check the array’s content with the <code>in</code> keyword.</p>
<p>Why have our filter as a string and turn it into an array? After all, we could export an array and edit it straight in the inspector.</p>
<p>However, in Godot 3.2, the experience editing arrays in the inspector is a bit tedious, which is why I went with a text string that I split.</p>
<p><em>Note that you can also use the <code>in</code> keyword to test if a string is part of another, so you could alternatively implement everything we’ll see below without arrays.</em></p>
<p>With that explanation out of the way, open up <code>/GUI/InventoryBar.gd</code> to create the filter list.</p>
<p>To prevent items from automatically going into the inventory when the filter doesn’t fit, we’ll update <code>add_to_first_available_inventory()</code>.</p>
<pre style="color:#f8f8f2;background-color:#272822"><span style="color:#75715e">## A textual representation of the possible items or categories of items the</span>
<span style="color:#75715e">## panels can accept, separated by spaces.</span>
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">var</span> item_filters :<span style="color:#f92672">=</span> <span style="color:#e6db74">&quot;&quot;</span>
<span style="color:#75715e">## The list split into an array of names. The second parameter prevents us from</span>
<span style="color:#75715e">## having empty strings (&quot;&quot;) in the array.</span>
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> _filter_list :<span style="color:#f92672">=</span> item_filters<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&quot; &quot;</span>, false)


<span style="color:#66d9ef">func</span> setup(gui: <span style="color:#a6e22e">Control</span>) <span style="color:#f92672">-&gt;</span> void:
    <span style="color:#75715e">#...</span>
    <span style="color:#75715e">#for panel in panels:</span>
        <span style="color:#75715e"># Here, we update the existing call to `setup()` and provide the filter</span>
        <span style="color:#75715e"># array to the panel children when we set them up.</span>
        <span style="color:#75715e"># We&#39;ll update the panel&#39;s `setup()` function definition in a moment.</span>
        panel<span style="color:#f92672">.</span>setup(gui, _filter_list)
        <span style="color:#75715e">#...</span>


<span style="color:#66d9ef">func</span> add_to_first_available_inventory(item: BlueprintEntity) <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">bool</span>:
    <span style="color:#75715e">#var item_name := Library.get_entity_name_from(item)</span>
    
    <span style="color:#75715e"># We provide the filter list and the name of the item to a special function</span>
    <span style="color:#75715e"># in `Library` to report on whether this is a valid item for the bar.</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> Library<span style="color:#f92672">.</span>is_valid_filter(_filter_list, item_name):
        <span style="color:#66d9ef">return</span> false
    <span style="color:#75715e"># ...</span>


<span style="color:#75715e">## When we consume an item like fuel, we need a way to make sure the stack count</span>
<span style="color:#75715e">## is up to date.</span>
<span style="color:#75715e">## this helper function will keep the label up to date on its panel children.</span>
<span style="color:#66d9ef">func</span> update_labels() <span style="color:#f92672">-&gt;</span> void:
    <span style="color:#66d9ef">for</span> panel <span style="color:#f92672">in</span> panels:
        <span style="color:#66d9ef">if</span> panel<span style="color:#f92672">.</span>held_item:
            panel<span style="color:#f92672">.</span>_update_label()
</pre>
<p>As you can see, our new code depends on a special function in <code>Library</code>: <code>is_valid_filter()</code>.</p>
<p>The function will take an array of filter names and the item to compare.</p>
<p>This will allow us to compare items to entire categories like fuels.</p>
<p>Let’s open <code>/Autoload/Library.gd</code> to add this function.</p>
<pre style="color:#f8f8f2;background-color:#272822"><span style="color:#75715e">## Returns `true` if the provided item matches the provided filter array.</span>
<span style="color:#66d9ef">func</span> is_valid_filter(filter_list: <span style="color:#a6e22e">Array</span>, item_name: <span style="color:#a6e22e">String</span>) <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">bool</span>:
    <span style="color:#75715e"># If the filter list is empty, then it&#39;s automatically allowed.</span>
    <span style="color:#75715e"># Otherwise, we check first if the item is explicitly listed in the list.</span>
    <span style="color:#66d9ef">if</span> filter_list<span style="color:#f92672">.</span>empty() <span style="color:#f92672">or</span> item_name <span style="color:#f92672">in</span> filter_list:
        <span style="color:#66d9ef">return</span> true

    <span style="color:#75715e"># If it&#39;s not, we check any listed item categories in the filter list and if</span>
    <span style="color:#75715e"># there&#39;s one defined, we look it up in the recipes.</span>
    <span style="color:#66d9ef">if</span> filter_list<span style="color:#f92672">.</span>has(<span style="color:#e6db74">&quot;Fuels&quot;</span>) <span style="color:#f92672">and</span> Recipes<span style="color:#f92672">.</span>Fuels<span style="color:#f92672">.</span>has(item_name):
        <span style="color:#66d9ef">return</span> true

    <span style="color:#66d9ef">return</span> false
</pre>
<p>This takes us to <code>Recipes</code>, where we can check to see if the item belongs to that particular category of objects.</p>
<p>That lets us make an inventory that only accepts fuels by listing “Fuels” without going through and listing “Lumber” and “Branches” individually.</p>
<p>What if we decided to add “Coal” and “NuclearCell” in the future?</p>
<p>We’d have to go through every machine and entity that takes fuel and update each one!</p>
<p>It’s much easier just to say “Fuels” and use the category throughout our codebase.</p>
<p>Head to <code>/Systems/Recipes.gd</code> to add this new dictionary.</p>
<p>We can add some recipes to the <code>Crafting</code> dictionary for the new entities we’ve been creating the last few lessons while we’re here.</p>
<pre style="color:#f8f8f2;background-color:#272822"><span style="color:#66d9ef">const</span> Crafting :<span style="color:#f92672">=</span> {
    <span style="color:#75715e">#...</span>
    <span style="color:#75715e"># We append new recipes to the existing list.</span>
    Pickaxe <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Branches&quot;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&quot;Ingot&quot;</span>: <span style="color:#ae81ff">3</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>},
    CrudePickaxe <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Branches&quot;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&quot;Stone&quot;</span>: <span style="color:#ae81ff">5</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>},
    Axe <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Branches&quot;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&quot;Ingot&quot;</span>: <span style="color:#ae81ff">3</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>},
    CrudeAxe <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Branches&quot;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&quot;Stone&quot;</span>: <span style="color:#ae81ff">5</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>},
    Branches <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Lumber&quot;</span>: <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&quot;Axe&quot;</span>: <span style="color:#ae81ff">0</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>},
    Chest <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Lumber&quot;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&quot;Branches&quot;</span>: <span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&quot;Ingot&quot;</span>: <span style="color:#ae81ff">1</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>}
}

<span style="color:#75715e">## Holds a dictionary of the types of things that are considered fuels and how</span>
<span style="color:#75715e">## much work time they provide in seconds when burnt.</span>
<span style="color:#66d9ef">const</span> Fuels :<span style="color:#f92672">=</span> {Lumber <span style="color:#f92672">=</span> <span style="color:#ae81ff">50.0</span>, Branches <span style="color:#f92672">=</span> <span style="color:#ae81ff">10.0</span>}
</pre>
<p>The last place to update with this new filtering ability is <code>/GUI/InventoryPanel.gd</code>, to prevent the user from putting stuff where it shouldn’t fit.</p>
<p>We need to update the <code>setup()</code> function to store the list and then use it in <code>_gui_input()</code>.</p>
<p>Below, we update three lines that checked for <code>left_click</code> or <code>right_click</code> to also check for the item filter.</p>
<pre style="color:#f8f8f2;background-color:#272822"><span style="color:#66d9ef">var</span> _filter_list :<span style="color:#f92672">=</span> []


<span style="color:#75715e"># Below, I included some existing lines of code in comments to help you track down the ones to update.</span>
<span style="color:#66d9ef">func</span> _gui_input(event: <span style="color:#a6e22e">InputEvent</span>) <span style="color:#f92672">-&gt;</span> void:
    <span style="color:#75715e">#...</span>
    <span style="color:#75715e">#if left_click or right_click:</span>
        <span style="color:#75715e">#if gui.blueprint:</span>
            <span style="color:#75715e">#var blueprint_name := Library.get_entity_name_from(gui.blueprint)</span>
            <span style="color:#75715e">#if held_item:</span>
                <span style="color:#75715e">#...</span>

                <span style="color:#75715e">#if item_is_same_type and stack_has_space:</span>
                    <span style="color:#75715e">#...</span>
                <span style="color:#75715e">#else:</span>
                    <span style="color:#66d9ef">if</span> left_click <span style="color:#f92672">and</span> Library<span style="color:#f92672">.</span>is_valid_filter(_filter_list, blueprint_name):
                        <span style="color:#75715e">#_swap_items()</span>
            <span style="color:#75715e">#else:</span>
                <span style="color:#66d9ef">if</span> left_click <span style="color:#f92672">and</span> Library<span style="color:#f92672">.</span>is_valid_filter(_filter_list, blueprint_name):
                    <span style="color:#75715e">#_grab_item()</span>

                <span style="color:#66d9ef">elif</span> right_click <span style="color:#f92672">and</span> Library<span style="color:#f92672">.</span>is_valid_filter(_filter_list, blueprint_name):
                    <span style="color:#75715e">#...</span>
    <span style="color:#75715e">#...</span>


<span style="color:#75715e">## Notice the new argument below, `filter_list`.</span>
<span style="color:#66d9ef">func</span> setup(_gui: <span style="color:#a6e22e">Control</span>, filter_list :<span style="color:#f92672">=</span> []) <span style="color:#f92672">-&gt;</span> void:
    <span style="color:#75715e">#...</span>
    _filter_list <span style="color:#f92672">=</span> filter_list
</pre>
<p>That should do it for filtering the inventory.</p>
<p>In the next lesson, we’ll design the Stirling engine’s user interface and put our filter to use. The engine will only accept fuel.</p>
<h2 id="code-reference">Code reference</h2>
<p>In <code>/GUI/InventoryBar.gd</code>, we added two properties, the <code>update_labels()</code> function, and updated the <code>add_to_first_available_inventory()</code> and <code>setup()</code> functions.</p>
<pre style="color:#f8f8f2;background-color:#272822"><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">var</span> item_filters :<span style="color:#f92672">=</span> <span style="color:#e6db74">&quot;&quot;</span>

<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> _filter_list :<span style="color:#f92672">=</span> item_filters<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&quot; &quot;</span>, false)


<span style="color:#66d9ef">func</span> setup(gui: <span style="color:#a6e22e">Control</span>) <span style="color:#f92672">-&gt;</span> void:
    <span style="color:#66d9ef">if</span> setup:
        <span style="color:#66d9ef">return</span>

    setup <span style="color:#f92672">=</span> true

    <span style="color:#66d9ef">for</span> panel <span style="color:#f92672">in</span> panels:
        panel<span style="color:#f92672">.</span>setup(gui, _filter_list)
        panel<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&quot;held_item_changed&quot;</span>, self, <span style="color:#e6db74">&quot;_on_Panel_held_item_changed&quot;</span>)


<span style="color:#66d9ef">func</span> add_to_first_available_inventory(item: BlueprintEntity) <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">bool</span>:
    <span style="color:#66d9ef">var</span> item_name :<span style="color:#f92672">=</span> Library<span style="color:#f92672">.</span>get_entity_name_from(item)

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> Library<span style="color:#f92672">.</span>is_valid_filter(_filter_list, item_name):
        <span style="color:#66d9ef">return</span> false

    <span style="color:#66d9ef">for</span> panel <span style="color:#f92672">in</span> panels:
        <span style="color:#66d9ef">if</span> (
            panel<span style="color:#f92672">.</span>held_item
            <span style="color:#f92672">and</span> Library<span style="color:#f92672">.</span>get_entity_name_from(panel<span style="color:#f92672">.</span>held_item) <span style="color:#f92672">==</span> item_name
            <span style="color:#f92672">and</span> panel<span style="color:#f92672">.</span>held_item<span style="color:#f92672">.</span>stack_count <span style="color:#f92672">&lt;</span> panel<span style="color:#f92672">.</span>held_item<span style="color:#f92672">.</span>stack_size
        ):
            <span style="color:#66d9ef">var</span> available_space: <span style="color:#a6e22e">int</span> <span style="color:#f92672">=</span> panel<span style="color:#f92672">.</span>held_item<span style="color:#f92672">.</span>stack_size <span style="color:#f92672">-</span> panel<span style="color:#f92672">.</span>held_item<span style="color:#f92672">.</span>stack_count
            
            <span style="color:#66d9ef">if</span> item<span style="color:#f92672">.</span>stack_count <span style="color:#f92672">&gt;</span> available_space:
                <span style="color:#66d9ef">var</span> transfer_count :<span style="color:#f92672">=</span> item<span style="color:#f92672">.</span>stack_count <span style="color:#f92672">-</span> available_space
                panel<span style="color:#f92672">.</span>held_item<span style="color:#f92672">.</span>stack_count <span style="color:#f92672">+=</span> transfer_count
                item<span style="color:#f92672">.</span>stack_count <span style="color:#f92672">-=</span> transfer_count
            <span style="color:#66d9ef">else</span>:
                panel<span style="color:#f92672">.</span>held_item<span style="color:#f92672">.</span>stack_count <span style="color:#f92672">+=</span> item<span style="color:#f92672">.</span>stack_count
                item<span style="color:#f92672">.</span>queue_free()
                <span style="color:#66d9ef">return</span> true

        <span style="color:#66d9ef">elif</span> <span style="color:#f92672">not</span> panel<span style="color:#f92672">.</span>held_item:
            panel<span style="color:#f92672">.</span>held_item <span style="color:#f92672">=</span> item
            <span style="color:#66d9ef">return</span> true

    <span style="color:#66d9ef">return</span> false


<span style="color:#66d9ef">func</span> update_labels() <span style="color:#f92672">-&gt;</span> void:
    <span style="color:#66d9ef">for</span> panel <span style="color:#f92672">in</span> panels:
        <span style="color:#66d9ef">if</span> panel<span style="color:#f92672">.</span>held_item:
            panel<span style="color:#f92672">.</span>_update_label()
</pre>
<p>In <code>/Autoload/Library.gd</code>, we added one function, <code>is_valid_filter()</code>.</p>
<pre style="color:#f8f8f2;background-color:#272822"><span style="color:#66d9ef">func</span> is_valid_filter(filter_list: <span style="color:#a6e22e">Array</span>, item_name: <span style="color:#a6e22e">String</span>) <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">bool</span>:
    <span style="color:#66d9ef">if</span> filter_list<span style="color:#f92672">.</span>empty() <span style="color:#f92672">or</span> item_name <span style="color:#f92672">in</span> filter_list:
        <span style="color:#66d9ef">return</span> true

    <span style="color:#66d9ef">if</span> filter_list<span style="color:#f92672">.</span>has(<span style="color:#e6db74">&quot;Fuels&quot;</span>) <span style="color:#f92672">and</span> Recipes<span style="color:#f92672">.</span>Fuels<span style="color:#f92672">.</span>has(item_name):
        <span style="color:#66d9ef">return</span> true

    <span style="color:#66d9ef">return</span> false
</pre>
<p><code>/Systems/Recipes.gd</code></p>
<pre style="color:#f8f8f2;background-color:#272822">class_name Recipes
<span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Reference</span>

<span style="color:#66d9ef">const</span> Crafting :<span style="color:#f92672">=</span> {
    StirlingEngine <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Ingot&quot;</span>: <span style="color:#ae81ff">8</span>, <span style="color:#e6db74">&quot;Wire&quot;</span>: <span style="color:#ae81ff">3</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>},
    Wire <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Ingot&quot;</span>: <span style="color:#ae81ff">2</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>},
    Battery <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Ingot&quot;</span>: <span style="color:#ae81ff">12</span>, <span style="color:#e6db74">&quot;Wire&quot;</span>: <span style="color:#ae81ff">5</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>},
    Pickaxe <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Branches&quot;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&quot;Ingot&quot;</span>: <span style="color:#ae81ff">3</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>},
    CrudePickaxe <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Branches&quot;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&quot;Stone&quot;</span>: <span style="color:#ae81ff">5</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>},
    Axe <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Branches&quot;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&quot;Ingot&quot;</span>: <span style="color:#ae81ff">3</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>},
    CrudeAxe <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Branches&quot;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&quot;Stone&quot;</span>: <span style="color:#ae81ff">5</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>},
    Branches <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Lumber&quot;</span>: <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&quot;Axe&quot;</span>: <span style="color:#ae81ff">0</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>},
    Chest <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Lumber&quot;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&quot;Branches&quot;</span>: <span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&quot;Ingot&quot;</span>: <span style="color:#ae81ff">1</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>}
}

<span style="color:#66d9ef">const</span> Fuels :<span style="color:#f92672">=</span> {Lumber <span style="color:#f92672">=</span> <span style="color:#ae81ff">50.0</span>, Branches <span style="color:#f92672">=</span> <span style="color:#ae81ff">10.0</span>}
</pre>
<p>In <code>/GUI/InventoryPanel.gd</code>, we added the <code>_filter_list</code> property, and updated <code>_gui_input()</code> and <code>setup()</code>.</p>
<pre style="color:#f8f8f2;background-color:#272822"><span style="color:#66d9ef">var</span> _filter_list :<span style="color:#f92672">=</span> []


<span style="color:#66d9ef">func</span> _gui_input(event: <span style="color:#a6e22e">InputEvent</span>) <span style="color:#f92672">-&gt;</span> void:
    <span style="color:#66d9ef">var</span> left_click :<span style="color:#f92672">=</span> event<span style="color:#f92672">.</span>is_action_pressed(<span style="color:#e6db74">&quot;left_click&quot;</span>)
    <span style="color:#66d9ef">var</span> right_click :<span style="color:#f92672">=</span> event<span style="color:#f92672">.</span>is_action_pressed(<span style="color:#e6db74">&quot;right_click&quot;</span>)

    <span style="color:#66d9ef">if</span> left_click <span style="color:#f92672">or</span> right_click:
        <span style="color:#66d9ef">if</span> gui<span style="color:#f92672">.</span>blueprint:
            <span style="color:#66d9ef">var</span> blueprint_name :<span style="color:#f92672">=</span> Library<span style="color:#f92672">.</span>get_entity_name_from(gui<span style="color:#f92672">.</span>blueprint)
            <span style="color:#66d9ef">if</span> held_item:
                <span style="color:#66d9ef">var</span> held_item_name :<span style="color:#f92672">=</span> Library<span style="color:#f92672">.</span>get_entity_name_from(held_item)

                <span style="color:#66d9ef">var</span> item_is_same_type: <span style="color:#a6e22e">bool</span> <span style="color:#f92672">=</span> held_item_name <span style="color:#f92672">==</span> blueprint_name
                <span style="color:#66d9ef">var</span> stack_has_space: <span style="color:#a6e22e">bool</span> <span style="color:#f92672">=</span> held_item<span style="color:#f92672">.</span>stack_count <span style="color:#f92672">&lt;</span> held_item<span style="color:#f92672">.</span>stack_size

                <span style="color:#66d9ef">if</span> item_is_same_type <span style="color:#f92672">and</span> stack_has_space:
                    <span style="color:#66d9ef">if</span> left_click:
                        _stack_items()
                    <span style="color:#66d9ef">elif</span> right_click:
                        _stack_items(true)
                <span style="color:#66d9ef">else</span>:
                    <span style="color:#66d9ef">if</span> left_click <span style="color:#f92672">and</span> Library<span style="color:#f92672">.</span>is_valid_filter(_filter_list, held_item_name):
                        _swap_items()
            <span style="color:#66d9ef">else</span>:
                <span style="color:#66d9ef">if</span> left_click <span style="color:#f92672">and</span> Library<span style="color:#f92672">.</span>is_valid_filter(_filter_list, blueprint_name):
                    _grab_item()
                <span style="color:#66d9ef">elif</span> right_click <span style="color:#f92672">and</span> Library<span style="color:#f92672">.</span>is_valid_filter(_filter_list, blueprint_name):
                    <span style="color:#66d9ef">if</span> gui<span style="color:#f92672">.</span>blueprint<span style="color:#f92672">.</span>stack_count <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>:
                        _grab_split_items()
                    <span style="color:#66d9ef">else</span>:
                        _grab_item()
        <span style="color:#66d9ef">elif</span> held_item:
            <span style="color:#66d9ef">if</span> left_click:
                _release_item()
            <span style="color:#66d9ef">elif</span> right_click:
                <span style="color:#66d9ef">if</span> held_item<span style="color:#f92672">.</span>stack_count <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
                    _release_item()
                <span style="color:#66d9ef">else</span>:
                    _split_items()

    <span style="color:#66d9ef">elif</span> event is <span style="color:#a6e22e">InputEventMouseMotion</span> <span style="color:#f92672">and</span> held_item:
        Events<span style="color:#f92672">.</span>emit_signal(<span style="color:#e6db74">&quot;hovered_over_entity&quot;</span>, held_item)


<span style="color:#66d9ef">func</span> setup(_gui: <span style="color:#a6e22e">Control</span>, filter_list :<span style="color:#f92672">=</span> []) <span style="color:#f92672">-&gt;</span> void:
    gui <span style="color:#f92672">=</span> _gui
    _filter_list <span style="color:#f92672">=</span> filter_list
</pre>
</body>
</html>
